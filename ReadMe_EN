**Title:** A 5-inch Waveshare ESP32 S3 Touch LCD Turned into a Victron Device Monitor (BMV712, Orion XS50, IP22, SmartSolar)

**Project Description:**
This project allows the use of a Waveshare ESP32 S3 Touch LCD 5B board as a repeater for multiple Victron devices via Bluetooth. I wanted to consolidate the main datas from  four Victron devices on board onto a single screen:

*   BMV 712
*   Orion XS 50
*   SmartSolar 100/30
*   IP22 12/30 Charger

I find this more convenient than the small round Victron LCD displays, and I don't always want to have my phone in hand, especially while sailing, to check the Victron Connect app, even though it is very well-developed.
 ![Description de l'image](IMAGES/IMG_20251203_140255.jpg)


**THE WAVESHARE BOARD:** This is an "All-In-One" board. Its advantages are that it's larger than Victron displays: 5 inches 1024*600, touchscreen, easy to connect as it has a 7-36V power input, and it communicates via Bluetooth with Victron devices. It has a CAN I/O potentially interfacable with the onboard NMEA2000 network. Its price is reasonable, under 50â‚¬. Learn more: https://www.waveshare.com/esp32-s3-touch-lcd-5.htm

**SOFTWARE:** The code was developed using the Arduino IDE 2.3.6 with the help of Anthropic's Claude Sonnet Opus 4.5 Pro. It's written in C++ and LVGL (https://lvgl.io/).
*Dependencies:* Libraries
*   LVGL 8.4.0
*   ESP32_Display_Panel 1.04
*   ESP32_IO_Expander 1.1.1
*   Esp-lib-utils 0.3.0

**LVGL Configuration:** The LVGL configuration file "lv_conf.h" must be correctly set up for the board used. Ensure this by testing the "example" programs from the LVGL library. In this file, remember to select the fonts used by the project (section "Font usage"), also select the following parameters to achieve gradient colors for the background.

**CUSTOMIZATION:** Some elements must be customized in the code (section: "Customization") according to the boat, the service battery, and especially the characteristics of the Victron devices:
*   In the main file `WS_IA_V8.XX_RXXX.INO`:
    *   Boat name
*   In the file `acquisition_BP.cpp`:
    *   Capacity of the battery bank managed by the BMV712 (Ah)
    *   Solar panel power (Watt)
    *   Alternator power (A)
    *   Shore charger power (A)
    *   MAC address of each Victron device
    *   Encryption key of each Victron device.

The MAC address and encryption key for each device must be obtained using the VictronConnect app available for Android or iOS. In the app, for each device, click on the gear icon / 3-dot menu / Product Info / Ensure Bluetooth is enabled (NEVER disable Bluetooth, this can be irreversible). At the bottom of the screen, click on Encryption Data, on the next screen note down the MAC Address and the Encryption Key. These two pieces of information must be entered into the source code in the required format.

**Warning:** A Victron device's encryption key changes if you change its PIN code. Therefore, if you change the PIN code of one of your devices to secure its Bluetooth access, you must update the encryption key in the code and recompile, otherwise the Waveshare board will not recognize that device.

**IMAGES:** The splash screen images were generated by Microsoft Copilot in ".PNG" format and converted to ".c" using the LVGL image converter. https://lvgl.io/tools/imageconverter
*Conversion settings:*
*   LVGL V8
*   Format: CF_TRUE_COLOR
*   C array
*   Dither images

The background image for the splash screen is 3 times smaller than the screen, 341x200 instead of 1024x600. LVGL zooms it by a factor of 3 for full-screen display. The small Victron logo is displayed at its native size.

**OPERATIONAL NOTES:**
*   Data refresh occurs approximately every 1.5 seconds. Note: During testing, I noticed that the IP22 seems to have a less powerful Bluetooth emission compared to other devices. Additionally, it can happen that the signal becomes degraded and packets are missed, resulting in a more spaced-out refresh rate. This issue disappears if you bring the ESP32 closer to the IP22.
*   The production displayed at the bottom left is the daily production. This data comes from the SmartSolar.
*   The "Status" is the status detected by the SmartSolar (Bulk, Absorption, etc.).
*   The TTG (Time To Go) is the estimated battery autonomy duration. If Production > Consumption, the TTG becomes "Infinite".
*   The amperes displayed at the bottom right come from the BMV712, so it represents the net balance between what is consumed and what is produced. If the amperage becomes negative (Consumption > Production), the value display turns orange.
*   "Full" indicates how long it will take for the battery to be fully charged based on production and consumption. If Consumption > Production, it simply displays "---".
*   Standby Mode:Touching the screen activates standby mode, meaning dimmed backlight. This isn't truly a brightness adjustment, which I haven't found for this board. I worked around it by overlaying a black screen with 80% opacity. To return to normal mode, touch the screen again. Sometimes you need to be persistent when it doesn't respond immediately. This is the major drawback, as tests with continuous BLE reception or using FreeRTOS and mutexes did not yield good results in terms of data reception, even though it made the touch response more reactive.
