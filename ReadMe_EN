Bien sûr — voici **l’intégralité du texte traduit**, réaffiché en un seul bloc continu pour que tu puisses tout voir facilement.

---

# Victron‑Energy‑Monitor‑WaveShare  
A Waveshare ESP32 S3 Touch LCD 5B turned into a monitoring screen for Victron devices (BMV712, Orion XS50, IP22, SmartSolar)

For the English version, please read the file **ReadMe_EN.md**.

This project allows you to use a Waveshare ESP32 S3 Touch LCD 5B as a Bluetooth repeater and monitoring display for several Victron devices.  
I wanted to consolidate the key data from the four onboard Victron devices onto a single screen:

- BMV‑712  
- Orion XS 50  
- SmartSolar 100/30  
- IP22 12/30 charger  

I find this more convenient than the small round Victron displays, and I don’t always want to use my phone—especially while sailing—to check the VictronConnect app, even though it is very well designed.

---

## WAVESHARE BOARD

This is an “All‑In‑One” board. Its advantages include a larger display than Victron screens (5" 1024×600), capacitive touch, easy wiring thanks to a 7–36V power input, and Bluetooth communication with Victron devices.  
It also features a CAN I/O interface that could potentially be connected to an onboard NMEA2000 network.  
Its price is reasonable, under €50.

More info: https://www.waveshare.com/esp32-s3-touch-lcd-5.htm

---

## SOFTWARE

The code was developed using **Arduino IDE 2.3.6**, with assistance from **Anthropic Claude Sonnet Opus 4.5 Pro**.  
It is written in **C++** and **LVGL** (https://lvgl.io/).

### Dependencies (Libraries)

- LVGL 8.4.0  
- ESP32_Display_Panel 1.04  
- ESP32_IO_Expander 1.1.1  
- Esp‑lib‑utils 0.3.0  

### LVGL Configuration

The LVGL configuration file `lv_conf.h` must be correctly set up for the Waveshare board.  
Verify this by running the LVGL library “examples”.

In this file, do not forget to:

- Enable the fonts used by the project (section **Font usage**)  
- Enable the required options to allow gradient background colors  

---

## CUSTOMIZATION

Several elements **must** be customized in the code (section “Personnalisation”) depending on the boat, the service battery, and especially the characteristics of the Victron devices.

### In the main file `WS_IA_V8.XX_RXXX.ino`:

Boat name displayed on the splash screen and in the header of the main screen:

```cpp
const char *NOM_BATEAU = "ALBA III";
```

### In the file `acquisition_BT.cpp`:

- Battery bank capacity managed by the BMV712 (Ah)  
- Solar panel power (W)  
- Alternator power (A)  
- Shore charger power (A)

```cpp
// Victron device characteristics
int CAPACITE_BATTERIE_AH = 280;  // Battery capacity (Ah) for TTG calculations
int PSOL = 350;   // Max solar panel power (W)
int PALT = 50;    // Max alternator output (A)
int PQUAI = 30;   // Max shore charger output (A)
```

#### MAC address of each Victron device  
Note: Uppercase/lowercase may matter.

```cpp
// Victron device MAC addresses
#define MAC_SMARTSOLAR "f3:81:dc:56:9f:97"
#define MAC_BMV_712    "c5:1d:ac:ed:91:92"
#define MAC_ORION_XS   "fb:c1:a3:08:4e:8c"
#define MAC_IP22       "fb:82:24:5d:bb:27"
```

#### Encryption keys for each Victron device

```cpp
// Decryption keys
uint8_t key_SmartSolar[16] = { ... };
uint8_t key_BMV[16]        = { ... };
uint8_t key_OrionXS[16]    = { ... };
uint8_t key_IP22[16]       = { ... };
```

The **MAC address** and **encryption key** for each device must be retrieved using the **VictronConnect** app (Android/iOS):

1. Open the device  
2. Tap the gear icon → 3‑dot menu → Product info  
3. Ensure Bluetooth is enabled (NEVER disable Bluetooth; this may be irreversible)  
4. At the bottom, tap **Encryption Data**  
5. Note the MAC address and encryption key  

These values must be copied into the source code using the correct format:

- MAC address: 6 bytes, lowercase (e.g., `f3:81:dc:...`)  
- Encryption key: 16 bytes, uppercase hex (e.g., `0x4B, 0x05, ...`)  

⚠️ **Warning:**  
If you change the PIN code of a Victron device, its encryption key changes.  
You must update the key in the code and recompile, otherwise the Waveshare board will no longer recognize the device.

#### Optional: Clear‑text device names (for clearer debug messages)

```cpp
// Device names
#define NAME_SMARTSOLAR "SmartSolar"
#define NAME_BMV_712    "BMV-712"
#define NAME_ORION_XS   "Orion XS"
#define NAME_IP22       "IP22"
```

---

## IMAGES

The splash screen images were generated with Microsoft Copilot in PNG format, then converted to `.c` using the LVGL image converter:  
https://lvgl.io/tools/imageconverter

Conversion settings:

- LVGL V8  
- Format: CF_TRUE_COLOR  
- C array  
- Dither images  

The splash background image is 3× smaller than the screen (341×200 instead of 1024×600).  
LVGL scales it up to full screen.  
The small Victron logo is displayed at its native resolution.

---

## NOTES ON OPERATION

- Data refresh rate is approximately **1.5 seconds**.  
  During testing, the IP22 appeared to have weaker Bluetooth transmission than the other devices, which may cause packet loss and slower refresh. Moving the ESP32 closer to the IP22 resolves this.

- The red dot in the corner of each gauge indicates reception of new data.  
  If the device stops transmitting for 15 seconds, the indicator turns off (1 minute for IP22).

- The production value (bottom left) is the **daily solar production**, from SmartSolar.

- The **Status** field shows the SmartSolar charging state (Bulk, Absorption, etc.).

- **TTG (Time To Go)** is the estimated battery autonomy.  
  If Production > Consumption, TTG becomes “Infinite”.

- The current displayed bottom‑right comes from the BMV712: it is the net balance of consumption and production.  
  If the current becomes negative (Consumption > Production), the value turns orange.

- **Full** indicates how long until the battery reaches 100% based on current production/consumption.  
  If Consumption > Production, Full displays “---”.

- **Sleep mode:**  
  Touching the screen toggles a dimmed mode.  
  This is not true brightness control (which I did not find for this board).  
  Instead, a semi‑transparent black overlay (80% opacity) is displayed.  
  Touch again to return to normal mode.  
  Sometimes it requires multiple touches.  
  BLE reception tests with continuous scanning or FreeRTOS mutexes degraded data reception, even though touch responsiveness improved.

---

Si tu veux, je peux aussi te le mettre en **README.md formaté**, ou en **version anglaise plus “GitHub pro”**.
